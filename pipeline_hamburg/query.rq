PREFIX rdf:      <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs:     <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd:      <http://www.w3.org/2001/XMLSchema#>
PREFIX sosa:     <http://www.w3.org/ns/sosa/>
PREFIX ssn:      <http://www.w3.org/ns/ssn/>
PREFIX time:     <http://www.w3.org/2006/time#>
PREFIX geo:      <http://www.opengis.net/ont/geosparql#>
PREFIX sf:       <http://www.opengis.net/ont/sf#>
PREFIX prov:     <http://www.w3.org/ns/prov#>
PREFIX dct:      <http://purl.org/dc/terms/>
PREFIX stapi:    <https://w3id.org/stapi#>
PREFIX verkeer:  <https://data.vlaanderen.be/ns/verkeersmetingen#>
PREFIX impl:     <https://implementatie.data.vlaanderen.be/ns/vsds-verkeersmetingen#>
PREFIX iso19156-ob: <http://def.isotc211.org/iso19156/2011/Observation#>
PREFIX iso19156-sp: <http://def.isotc211.org/iso19156/2011/SamplingPoint#>
PREFIX LinkDirectionValue: <https://inspire.ec.europa.eu/codelist/LinkDirectionValue/>
PREFIX MeasureTypes: <http://def.isotc211.org/iso19103/2015/MeasureTypes#>
PREFIX VkmMeetInstrumentType: <https://data.vlaanderen.be/doc/concept/VkmMeetInstrumentType/>
PREFIX VkmVerkeersKenmerkType: <https://data.vlaanderen.be/doc/concept/VkmVerkeersKenmerkType/>
PREFIX VkmVoertuigType: <https://data.vlaanderen.be/doc/concept/VkmVoertuigType/>
PREFIX by-time: <https://ldes.telraam-api.net/observations/by-time/>
PREFIX cdt: <https://w3id.org/cdt/>
PREFIX cl-mit: <https://data.vlaanderen.be/doc/concept/VkmMeetInstrumentType/>
PREFIX cl-op: <https://data.vlaanderen.be/doc/concept/VkmObservatieProcedure/>
PREFIX cl-trt: <https://inspire.ec.europa.eu/codelist/LinkDirectionValue/>
PREFIX cl-vkt: <https://data.vlaanderen.be/doc/concept/VkmVerkeersKenmerkType/>
PREFIX cl-vrt: <https://data.vlaanderen.be/doc/concept/VkmVoertuigType/>
PREFIX dcat: <http://www.w3.org/ns/dcat#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX dv-netwerk: <https://data.vlaanderen.be/ns/netwerk#>
PREFIX dv-om: <https://data.vlaanderen.be/ns/observaties-en-metingen/#>
PREFIX dv-weg: <https://data.vlaanderen.be/ns/weg#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX geoc: <https://opengis.net/def/function/geosparql/custom#>
PREFIX geosparql: <http://www.opengis.net/ont/geosparql#>
PREFIX impl: <https://implementatie.data.vlaanderen.be/ns/vsds-verkeersmetingen#>
PREFIX iso19103-mp: <http://def.isotc211.org/iso19103/2015/MeasureTypes#>
PREFIX iso19156-ob: <http://def.isotc211.org/iso19156/2011/Observation#>
PREFIX iso19156-sp: <http://def.isotc211.org/iso19156/2011/SamplingPoint#>
PREFIX ldes: <https://w3id.org/ldes#>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX m8g: <http://data.europa.eu/m8g/>
PREFIX observations: <https://ldes.telraam-api.net/observations/>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX prov: <http://www.w3.org/ns/prov#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX schema: <https://schema.org/>
PREFIX sf: <http://www.opengis.net/ont/sf#>
PREFIX sh: <http://www.w3.org/ns/shacl#>
PREFIX shsh: <http://www.w3.org/ns/shacl-shacl#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX ssn: <http://www.w3.org/ns/ssn/>
PREFIX telraam: <https://telraam.net/en/location/>
PREFIX terms: <http://purl.org/dc/terms/>
PREFIX time: <http://www.w3.org/2006/time#>
PREFIX tree: <https://w3id.org/tree#>
PREFIX verkeer: <https://data.vlaanderen.be/ns/verkeersmetingen#>
PREFIX verkeersmetingen: <https://data.vlaanderen.be/ns/verkeersmetingen#>
PREFIX weg: <https://data.vlaanderen.be/ns/weg#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>


CONSTRUCT {

    ?obs a sosa:Observation, impl:Verkeerstelling, verkeersmetingen:Verkeersmeting ;
        iso19156-ob:OM_Observation.phenomenonTime  ?ptime;
        prov:generatedAtTime  ?rtime ;
        sosa:madeBySensor  ?sensor ;
        verkeersmetingen:geobserveerdObject  _:object ;
        impl:Verkeerstelling.geobserveerdKenmerk  ?obsprop ;
        impl:Verkeerstelling.tellingresultaat  ?doubleresult .

    ?ptime    rdf:type  time:TemporalEntity;
        time:hasBeginning    ?start;
        time:hasXSDDuration  ?duration .

    ?start    rdf:type                 time:Instant;
        time:inXSDDateTimeStamp  ?startTime .

    ?sensor    rdf:type    sosa:Sensor;
        terms:type  cl-mit:telraam .

    ?obsprop    rdf:type impl:Verkeerstellingkenmerk;
        verkeersmetingen:voertuigType  ?vehicletype;
        impl:Verkeerstellingkenmerk.kenmerktype  cl-vkt:aantal .

    _:object     rdf:type  verkeersmetingen:Verkeersmeetpunt ;
        iso19156-sp:SF_SamplingPoint.shape ?geom .

    ?geom    rdf:type         sf:Point;
        geosparql:asWKT  ?wkt .

} WHERE {

    # Observation alignment
    ?obs rdf:type stapi:Observation ;
        stapi:datastream ?ds ;
        stapi:featureOfInterest ?foi ;
        stapi:result ?result ;
        stapi:resultTime ?rtime ;
        stapi:phenomenonTime ?ptime .

    # Phenomenon time interval structure
    ?ptime time:hasBeginning ?start .
    ?start time:inXSDDateTimeStamp ?startTime .
    OPTIONAL { ?ptime time:hasEnd ?end . }
    OPTIONAL { ?end time:inXSDDateTimeStamp ?endTime . }
    OPTIONAL { ?ptime time:hasXSDDuration ?duration . }
    

    # # Feature of interest â†’ geometry
    ?foi rdf:type stapi:FeatureOfInterest ;
        stapi:name ?foiName .
    ?thing stapi:locations ?loc .

    # # location mapping
    ?loc geo:hasGeometry ?geom .
    ?geom geo:asWKT ?wkt ;
        geo:long ?long ;
        geo:lat ?lat .

    # Sensor
    ?ds stapi:sensor ?sensor ;
        stapi:observedProperty ?obsprop .


    BIND(xsd:double(?result) AS ?doubleresult)
}
